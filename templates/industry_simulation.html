<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>{{ stock_code }} 模擬交易</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- 字體 -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&display=swap" rel="stylesheet">

  <style>
    /* 1. 主題色 */
    :root{
      --primary:#043b8f;
      --primary-dark:#02347e;
      --primary-light:#6499e9;
      --secondary:#0b1f33;
    }

    /* 2. 全站字體 + 背景動畫 */
    html,body{height:100%;margin:0;}
    body{
      display:flex;
      flex-direction:column;
      font-family:'Noto Serif TC',serif;
      line-height:1.6;
      color:#0f172a;
      background:transparent;
    }
    body::before{
      content:"";
      position:fixed; inset:0;
      background:url("https://png.pngtree.com/thumb_back/fh260/background/20231227/pngtree-gentle-blue-background-with-a-soft-textured-finish-image_13898387.png") center/cover no-repeat;
      filter:grayscale(20%) brightness(0.55);
      z-index:-2;
      animation:bgZoom 40s ease-in-out infinite alternate;
    }
    @keyframes bgZoom{from{transform:scale(1);}to{transform:scale(1.15);}}

    h1,h2,h3,h4,h5,h6{font-weight:700;}

    /* 3. Home 按鈕 */
    .btn-home{
      position:fixed;top:20px;left:20px;
      display:inline-block;
      padding:.6rem 1.25rem;
      font-weight:700;
      border-radius:999px;
      border:1.5px solid var(--primary);
      background:#fff;
      color:var(--primary);
      text-decoration:none;
      transition:background .2s ease, color .2s ease, box-shadow .2s ease, transform .05s ease;
      z-index:1000;
    }
    .btn-home:hover{
      background:var(--primary);color:#fff;
      box-shadow:0 8px 16px rgba(4,59,143,.18);
      transform:translateY(-1px);
    }

    /* 4. 卡片容器 */
    .industry_info{
      background:rgba(255,255,255,.94);
      border-radius:.8rem;
      box-shadow:0 10px 30px rgba(0,0,0,.05);
      padding:2rem;
      max-width:1100px;
      width:100%;
      margin:4rem auto;
    }
    .industry_info h2{color:var(--primary);margin-bottom:1rem;text-align:center;}
    .industry_info h3{text-align:center;margin:.25rem 0;}

    /* 5. K 線圖 */
    .industry_chart{text-align:center;margin:1.5rem 0;}
    .stock_chart_img{
      max-width:100%;
      border-radius:.5rem;
      box-shadow:0 6px 18px rgba(0,0,0,.06);
    }

    /* 6. 按鈕 */
    .industry_btn{
      padding:.6rem 1.25rem;
      border-radius:2rem;
      border:1.5px solid var(--primary);
      background:#fff;
      color:var(--primary);
      font-weight:700;
      margin:.3rem;
      cursor:pointer;
      transition:background .2s ease, color .2s ease, box-shadow .2s ease;
    }
    .industry_btn:hover{
      background:var(--primary);
      color:#fff;
      box-shadow:0 6px 12px rgba(4,59,143,.15);
    }

    /* 7. 技術指標區塊 */
    .industry_indicators{
      display:grid;
      grid-template-columns:1fr 1fr 1fr;
      gap:1rem;
      margin-top:2rem;
    }
    .indicator_card{
      background:#fff;
      border:1px solid #e6ecf3;
      border-radius:.6rem;
      padding:1rem;
      box-shadow:0 4px 10px rgba(0,0,0,.05);
    }
    .indicator_card p{margin:.4rem 0;font-size:.95rem;}
    .indicator_description{font-size:.85rem;color:#444;}

    /* 8. 警示區 */
    .industry_alerts{
      margin-top:1.5rem;
      padding:1rem;
      background:#f9fafc;
      border:1px solid #e6ecf3;
      border-radius:.5rem;
    }

    .indicator_costume_block{
      margin-top:2rem;
      background:#fff;
      padding:1rem;
      border-radius:.5rem;
      box-shadow:0 4px 10px rgba(0,0,0,.05);
      font-size:.9rem;
    }
  </style>
</head>
<body>
  <!-- 左上角 Home 按鈕 -->
  <a href="{{ url_for('main') }}" class="btn-home">Home</a>

  <!-- 主要內容 -->
  <div class="industry_info">
    <h2>股票代號：{{ stock_code }}</h2>
    <h3>股價：<span id="latest_price">{{ latest_price }}</span></h3>
    <h3>帳戶餘額：<span id="balance">{{ balance }}</span></h3>
    <h3>持股數量：<span id="stock_count">{{ stock_count }}</span></h3>

    <div class="industry_chart">
      <img id="stock_chart" class="stock_chart_img" src="{{ plot_path }}" alt="K線圖">
    </div>

    <div style="text-align:center;">
      <button class="industry_btn" id="next_day_btn">下一天</button>
      <button class="industry_btn" id="next_month_btn">下個月</button>
      <br>
      <button class="industry_btn" id="buy_btn">買入</button>
      <button class="industry_btn" id="sell_btn">賣出</button>
      <button class="industry_btn" id="close_btn">平倉</button>
    </div>

    <div id="event_alerts" class="industry_alerts"></div>

    <div id="indicators" class="industry_indicators">
      <div class="indicator_card">
        <p>RSI: <span id="rsi_value">-</span></p>
        <p class="indicator_description">RSI 高於 70 → 可能超買；低於 30 → 可能超賣。</p>
      </div>
      <div class="indicator_card">
        <p>MACD: <span id="macd_value">-</span> | Signal: <span id="macd_signal">-</span></p>
        <p class="indicator_description">MACD &gt; Signal → 上升趨勢；反之 → 下降趨勢。</p>
      </div>
      <div class="indicator_card">
        <p>ADX: <span id="adx_value">-</span> | +DI: <span id="plus_di">-</span> | -DI: <span id="minus_di">-</span></p>
        <p class="indicator_description">數值高 → 趨勢強；低 → 盤整。</p>
      </div>
    </div>

    <div class="indicator_costume_block">
      以上 RSI / MACD / ADX 僅提供交易參考，需搭配時事與走勢圖判斷。
    </div>
  </div>

  <!-- 保留你原本的 jQuery 功能 -->
  <script>
  $(function() {
    function refreshBalanceAndCount() {
      $.get("/industry_get_balance", function(data){ $("#balance").text(data.balance); });
      $.get("/industry_get_stock_count", function(data){ $("#stock_count").text(data.stock_count); });
    }

    $("#buy_btn").click(function() {
      $.post("/industry_buy_stock", JSON.stringify({stock:"{{ stock_code }}", current_price:parseFloat($("#latest_price").text())}), function(){
        refreshBalanceAndCount(); alert("✅ 買入成功！");
      },"json").fail(xhr=>alert("買入失敗："+(xhr.responseJSON?.message||"未知錯誤")));
    });

    $("#sell_btn").click(function() {
      $.post("/industry_sell_stock", JSON.stringify({stock:"{{ stock_code }}", current_price:parseFloat($("#latest_price").text())}), function(){
        refreshBalanceAndCount(); alert("✅ 賣出成功！");
      },"json").fail(xhr=>alert("賣出失敗："+(xhr.responseJSON?.message||"未知錯誤")));
    });

    $("#close_btn").click(function() {
      $.post("/industry_close_position", JSON.stringify({stock:"{{ stock_code }}", current_price:parseFloat($("#latest_price").text())}), function(){
        refreshBalanceAndCount(); alert("✅ 平倉成功！");
      },"json").fail(xhr=>alert("平倉失敗："+(xhr.responseJSON?.message||"未知錯誤")));
    });

    $("#next_day_btn").click(function(){
      $(this).prop("disabled",true).text("載入中...");
      $.get("/industry_next_day").done(function(data){
        if(!data.error){
          $("#stock_chart").attr("src",data.plot_path+"?v="+Date.now());
          $("#latest_price").text(data.latest_price);
          $("#rsi_value").text(data.rsi);
          $("#macd_value").text(data.macd);
          $("#macd_signal").text(data.macd_signal);
          $("#adx_value").text(data.adx);
          $("#plus_di").text(data.plus_di);
          $("#minus_di").text(data.minus_di);
          $("#event_alerts").html(data.events.length?data.events.join("<br>"):"無即將到來的事件");
        } else alert(data.error);
      }).always(()=>$("#next_day_btn").prop("disabled",false).text("下一天"));
    });

    $("#next_month_btn").click(function(){
      $(this).prop("disabled",true).text("載入中...");
      $.get("/industry_next_month").done(function(data){
        if(!data.error){
          $("#stock_chart").attr("src",data.plot_path+"?v="+Date.now());
          $("#latest_price").text(data.latest_price);
          $("#rsi_value").text(data.rsi);
          $("#macd_value").text(data.macd);
          $("#macd_signal").text(data.macd_signal);
          $("#adx_value").text(data.adx);
          $("#plus_di").text(data.plus_di);
          $("#minus_di").text(data.minus_di);
          $("#event_alerts").html(data.events.length?data.events.join("<br>"):"無即將到來的事件");
        } else alert(data.error);
      }).always(()=>$("#next_month_btn").prop("disabled",false).text("下個月"));
    });
  });
  </script>
</body>
</html>
