<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gemini 問答</title>

  <!-- 全站字體：思源宋體（Noto Serif TC）-->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&display=swap" rel="stylesheet">

  <!-- Bootstrap 4.5 -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.3/css/bootstrap.min.css">

  <style>
    :root{
      --primary:#043b8f;
      --primary-dark:#02347e;
      --primary-light:#6499e9;
      --secondary:#0b1f33;
    }

    html,body{height:100%;}
    body{
      display:flex;
      flex-direction:column;
      font-family:'Noto Serif TC',serif;
      line-height:1.6;
      margin:0;
      background:transparent;
    }

    body::before{
      content:"";
      position:fixed; inset:0;
      background:url("https://png.pngtree.com/thumb_back/fh260/background/20231227/pngtree-gentle-blue-background-with-a-soft-textured-finish-image_13898387.png") center/cover no-repeat;
      filter:grayscale(20%) brightness(0.55);
      z-index:-1;
      animation:bgZoom 40s ease-in-out infinite alternate;
    }
    @keyframes bgZoom{from{transform:scale(1);}to{transform:scale(1.15);}}

    .card-wrapper{
      background:rgba(255,255,255,.94);
      border-radius:.8rem;
      box-shadow:0 10px 30px rgba(0,0,0,.05);
      padding:2rem;
      max-width:800px;
      width:100%;
      margin:3rem auto;
    }

    h2{
      font-size:1.8rem;
      color:var(--primary);
      text-align:center;
      margin-bottom:2rem;
      font-weight:700;
    }

    label{
      display:block;
      font-weight:700;
      color:var(--primary);
      text-align:left;
      margin:0 0 .4rem 0;
    }

    textarea{
      width: 90%;          /* 或 80%，依你喜好縮小 */
      max-width: 800px;    /* 限制最大寬度 */
      margin: 0 auto;      /* 水平置中 */
      display: block;
      font-size:1.125rem;
      padding:1rem;
      border-radius:.5rem;
      border:1px solid #cbd3e0;
      resize:vertical;
      background:#fff;
      margin-bottom:1.5rem;
    }

    #outputBox{ min-height:150px; }

    .btn{
      font-weight:700;
      border-radius:2rem;
      box-shadow:none !important;
      outline:none !important;
    }
    .btn-primary{
      background-color:var(--primary) !important;
      border-color:var(--primary) !important;
      color:#fff !important;
      transition:background-color .3s ease, box-shadow .3s ease;
    }
    .btn-primary:hover{
      background-color:var(--primary-dark) !important;
      border-color:var(--primary-dark) !important;
      box-shadow:0 6px 12px rgba(0,0,0,.12) !important;
    }
    .btn-outline-primary{
      color:var(--primary) !important;
      border-color:var(--primary) !important;
      background:transparent !important;
    }
    .btn-outline-primary:hover{
      background:var(--primary) !important;
      color:#fff !important;
      box-shadow:0 6px 12px rgba(0,0,0,.1) !important;
    }

    .btn-row{
      display:flex;
      justify-content:space-between;
      gap:1rem;
      margin-bottom:1.5rem;
    }
    .btn-row .btn{
      flex:1;
      padding:.6rem 0;
      font-size:1rem;
    }

    #loading{text-align:center;display:none;}
    #loading p{margin-top:10px;font-weight:bold;color:#004B97;}

    /* Home 按鈕固定在左上角 */
    .btn-home{
      position:fixed;
      top:20px;
      left:20px;
      display:inline-block;
      text-decoration:none;
      font-weight:700;
      padding:.6rem 1.25rem;
      border-radius:999px;
      border:1.5px solid var(--primary);
      background:#fff;
      color:var(--primary);
      transition:background .2s ease, color .2s ease, box-shadow .2s ease, transform .05s ease;
      z-index:1000;
    }
    .btn-home:hover{
      background:var(--primary);
      color:#fff;
      box-shadow:0 8px 16px rgba(4,59,143,.18);
      transform:translateY(-1px);
    }
    .btn-home:active{
      transform:translateY(0);
      box-shadow:0 4px 8px rgba(4,59,143,.18);
    }
  
    /* 右上角圓形「?」重看教學（與 Home 對稱） */
    .btn-help{
      position:fixed;
      top:20px;
      right:20px;
      z-index:1000;
      width:40px; height:40px; border-radius:999px; padding:0;
      display:inline-flex; align-items:center; justify-content:center;
      font-weight:800; line-height:1; font-size:18px;
      background:#fff; color:var(--primary);
      border:1.5px solid var(--primary);
      text-decoration:none;
      transition:background .2s ease, color .2s ease, box-shadow .2s ease, transform .05s ease;
      box-shadow:0 6px 12px rgba(0,0,0,.10);
    }
    .btn-help:hover{
      background:var(--primary);
      color:#fff;
      box-shadow:0 8px 16px rgba(4,59,143,.18);
      transform:translateY(-1px);
      text-decoration:none;
    }
    .btn-help:active{ transform:translateY(0); box-shadow:0 4px 8px rgba(4,59,143,.18); }
    .btn-help:focus{ outline:none; }
    .btn-help:focus-visible{ box-shadow:0 0 0 3px rgba(4,59,143,.25), 0 6px 16px rgba(0,0,0,.12); }

  </style>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/tutorial.css') }}">
</head>
<body>
  <!-- 左上角 Home 按鈕 -->
  <a href="{{ url_for('main') }}" class="btn-home">Home</a>

  <a href="#" class="btn-help" aria-label="Help" title="Help">?</a>

  <main class="flex-grow-1">
    <div class="container">
      <div class="card-wrapper">
        <h2>Gemini 問答系統</h2>

        <label for="inputBox">輸入您的問題：</label>
        <textarea id="inputBox" placeholder="輸入任意問題，如『什麼是股票』" rows="5"></textarea>

        <div class="btn-row">
          <button id="askBtn" class="btn btn-primary" onclick="sendQuestion()">提交問題</button>
          <button class="btn btn-outline-primary" onclick="clearFields()">清空</button>
        </div>

        <div id="loading">
          <div class="spinner-border text-primary" role="status" aria-hidden="true"></div>
          <p>分析中，請稍候...</p>
        </div>

        <label for="outputBox">回答：</label>
        <textarea id="outputBox" readonly rows="7"></textarea>
      </div>
    </div>
  </main>

  <script>
    async function sendQuestion() {
      const question = document.getElementById('inputBox').value.trim();
      if(!question){
        alert("請輸入問題！");
        return;
      }

      const loading = document.getElementById('loading');
      const askBtn = document.getElementById('askBtn');
      const output = document.getElementById('outputBox');

      loading.style.display = 'block';
      output.value = '';
      askBtn.disabled = true;

      try {
        const res = await fetch('/question_ask', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ question })
        });
        const data = await res.json();

        if(data.error){
          alert(data.error);
        } else {
          output.value = data.answer || '';
        }
      } catch(err){
        alert("❌ 發生錯誤：" + err);
      } finally {
        loading.style.display = 'none';
        askBtn.disabled = false;
      }
    }

    function clearFields(){
      document.getElementById('inputBox').value = '';
      document.getElementById('outputBox').value = '';
    }
  </script>
  <script src="{{ url_for('static', filename='js/tutorial.js') }}"></script>

  <script>
    (function(){
      function ready(fn){ if(document.readyState!=='loading') fn(); else document.addEventListener('DOMContentLoaded', fn); }
      function init(){
        if(typeof initImageTutorial !== 'function'){ return null; }
        return initImageTutorial({
          pageKey: 'question_ask',
          version: 'img-v1',
          images: [
            "{{ url_for('static', filename='image/tutorial/09_question_ask_1.png') }}",
            "{{ url_for('static', filename='image/tutorial/09_question_ask_2.png') }}"
          ],
          autoShow: true,
          enableEsc: true
        });
      }
      ready(function(){
        var tut = init();
        var tries = 0;
        if(!tut){
          var timer = setInterval(function(){
            tut = init(); tries++;
            if(tut || tries>30){ clearInterval(timer); }
          }, 100);
        }
        var help = document.querySelector('.btn-help');
        if(help){
          help.addEventListener('click', function(e){
            e.preventDefault();
            if(!tut) tut = init();
            try{ tut.clear(); tut.show(); }catch(err){ console.warn('[tutorial] show failed', err); }
          });
        }
      });
    })();
  </script>

</body>
</html>
